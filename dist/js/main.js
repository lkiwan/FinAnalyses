function redirectToAnalysis(e){e&&(window.location.href=`analysis.html?ticker=${e}`)}document.addEventListener("DOMContentLoaded",()=>{const e=window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")?"http://localhost:8000/api":"https://finanalyses.onrender.com/api",t=document.getElementById("company-search"),n=document.getElementById("analyze-btn"),r=document.getElementById("search-results"),s=document.getElementById("country-select"),o=document.getElementById("country-results"),a=document.getElementById("see-more-container"),c=document.getElementById("gainers-table-body"),i=document.getElementById("losers-table-body");if(t){let l;t.addEventListener("input",()=>{clearTimeout(l);const n=t.value.trim();n.length<1?r&&r.classList.add("hidden"):l=setTimeout(async()=>{try{const s=await fetch(`${e}/search?query=${n}`);if(!s.ok)throw new Error("Erreur de recherche");const o=await s.json();t=o,r&&(r.innerHTML="",0!==t.length?(t.forEach(e=>{const t=document.createElement("div");t.className="p-3 hover:bg-gray-100 cursor-pointer border-b last:border-b-0",t.innerHTML=`<span class="font-bold">${e.symbol}</span><span class="text-gray-600 ml-2">${e.name}</span>`,t.addEventListener("click",()=>redirectToAnalysis(e.symbol)),r.appendChild(t)}),r.classList.remove("hidden")):r.classList.add("hidden"))}catch(e){console.error("Erreur de recherche:",e),r&&r.classList.add("hidden")}var t},300)}),document.addEventListener("click",e=>{!r||t.contains(e.target)||r.contains(e.target)||r.classList.add("hidden")});const m=()=>{const e=t.value.trim().toUpperCase();e?redirectToAnalysis(e):alert("Veuillez entrer un nom ou un symbole boursier.")};n&&n.addEventListener("click",m),t.addEventListener("keypress",e=>{"Enter"===e.key&&m()})}if(s){s.addEventListener("change",async()=>{const t=s.value;if(!t)return o&&(o.innerHTML=""),void(a&&a.classList.add("hidden"));o&&(o.innerHTML='<p class="text-center text-gray-500 col-span-full">Chargement...</p>');try{const n=await fetch(`${e}/companies-by-country/${t}`);if(!n.ok)throw new Error("Erreur de chargement");!function(e){if(!o)return;if(o.innerHTML="",!e||0===e.length)return o.innerHTML='<p class="text-center text-gray-500 col-span-full">Aucune entreprise trouvée.</p>',void(a&&a.classList.add("hidden"));e.slice(0,9).forEach(e=>{const t=document.createElement("div");t.className="bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition cursor-pointer card-hover",t.innerHTML=`<h3 class="font-bold text-gray-900 truncate">${e.companyName}</h3><p class="text-sm text-blue-600 font-semibold">${e.symbol}</p><p class="text-xs text-gray-500 mt-2">${e.sector||"N/A"}</p>`,t.addEventListener("click",()=>redirectToAnalysis(e.symbol)),o.appendChild(t)}),e.length>9&&a?a.classList.remove("hidden"):a&&a.classList.add("hidden")}(await n.json())}catch(e){console.error("Erreur pays:",e),o&&(o.innerHTML='<p class="text-center text-red-500 col-span-full">Impossible de charger les entreprises.</p>')}})}if(c&&i){function d(e,t){const n=document.getElementById(t);if(!n)return;if(!e||0===e.length)return void(n.innerHTML='<p class="text-gray-400">Données non disponibles.</p>');n.innerHTML="";e.slice(0,5).forEach(e=>{n.innerHTML+=function(e){const t=e.changesPercentage>0?"text-green-400":"text-red-400";return`\n                <div class="flex items-center justify-between p-2 rounded hover:bg-gray-700 cursor-pointer" onclick="redirectToAnalysis('${e.symbol}')">\n                    <div>\n                        <p class="font-bold text-lg">${e.symbol}</p>\n                        <p class="text-sm text-gray-300 truncate">${e.name}</p>\n                    </div>\n                    <div class="text-right">\n                        <p class="font-semibold text-lg">${e.price.toFixed(2)}</p>\n                        <p class="${t} font-medium">${e.changesPercentage.toFixed(2)}%</p>\n                    </div>\n                </div>\n            `}(e)})}!async function(){try{const[t,n]=await Promise.all([fetch(`${e}/gainers`),fetch(`${e}/losers`)]);if(!t.ok||!n.ok)throw new Error("Une des requêtes pour les movers a échoué.");const r=await t.json(),s=await n.json();d(r,"gainers-table-body"),d(s,"losers-table-body")}catch(e){console.error("Erreur chargement Gainers/Losers:",e),c&&(c.innerHTML='<p class="text-red-400">Erreur de chargement.</p>'),i&&(i.innerHTML='<p class="text-red-400">Erreur de chargement.</p>')}}()}});